const path=require("path"),express=require("express"),session=require("express-session"),exphbs=require("express-handlebars"),routes=require("./controllers"),helpers=require("./utils/helpers"),morgan=require("morgan"),rt=require("file-stream-rotator"),fs=require("fs"),sequelize=require("./config/connection"),SequelizeStore=require("connect-session-sequelize")(session.Store),app=express(),PORT=process.env.PORT||3001,hbs=exphbs.create({helpers:helpers}),sess={secret:"Super secret secret",cookie:{},resave:!1,saveUninitialized:!0,store:new SequelizeStore({db:sequelize})};app.use(morgan("combined"));var accessLogStream=fs.createWriteStream(path.join(__dirname,"access.log"),{flags:"a"});app.use(morgan("combined",{stream:accessLogStream})),app.use(session(sess)),app.engine("handlebars",hbs.engine),app.set("view engine","handlebars"),app.use(express.json()),app.use(express.urlencoded({extended:!0})),app.use(express.static(path.join(__dirname,"public"))),app.use(routes),sequelize.sync({force:!1}).then(()=>{app.listen(PORT,()=>console.log("Now listening"))});